<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Covenant Pages</title>
 <link rel="icon" type="image/x-icon" href="icon.png">
 <!-- Bootstrap CSS -->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 <style>
 /* Custom styles for hover effects and specific colors */
 .card {
 transition: transform 0.3s ease, box-shadow 0.3s ease;
 cursor: pointer;
 }
 .card:hover {
 transform: translateY(-5px);
 box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
 }
 .hover-text {
  color: #b2b2b2; /* Dark gray text, matches subdued style */
  transition: color 0.2s ease-in-out; /* Smooth transition */
  border: 1px solid #b2b2b2;
  border-radius: 5px;
  padding: 0px 5px;
  margin: 0px;
}

.hover-text:hover {
  color: #343d68; /* Slightly lighter text on hover */
}
        .card-body {
            padding-bottom: 5px; /* Ensure space for the absolutely positioned element */
            min-height: 100%; /* Ensure the card-body takes full height of the card */
        }
 .highlight {
 color: #4a77cc;
 }
 .accent-bg {
 background-color: #4a77cc;
 color: white;
 }
 .header-bg {
 background: linear-gradient(to left, #343d68, #FFFFFF);
 }
 .title-font {
 font-family: 'Poppins', sans-serif;
 }
 .modal-content {
 border-radius: 10px;
 }
 .modal-header {
 background-color: #4a77cc;
 color: #fff;
 }
 /* Hide cards by default */
 .card-col {
 display: none;
 }
 /* Show the cards for active category */
 .card-col.active {
 display: block;
 }
 /* Category button styles */
 .category-btn {
 margin: 0.2rem;
 border-color: #343d68;
 color: #343d68;
 }
 .category-btn:hover {
 border-color: #4a77cc; /* Complementary light green */
 color: #4a77cc;
 }
 .category-btn.active {
 background-color: #62698a;
 border-color: #62698a;
 color: #fff;
 }
 </style>
</head>
<body class="bg-white">
 <!-- Header -->
 <header class="header-bg shadow-sm">
 <nav class="navbar navbar-expand-lg navbar-light container">
 <div class="container-fluid">
 <a class="navbar-brand title fw-bold fs-4 text-dark" href="#">
 <img src="logo.png" alt="Covenant Pages Logo" style="height: 40px; margin-right: 10px;">Covenant Pages
 </a>
 <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
 <span class="navbar-toggler-icon"></span>
 </button>
 <div class="collapse navbar-collapse" id="navbarNav">
 <ul class="navbar-nav ms-auto">
 <li class="nav-item">
 <a class="nav-link text-light" href="https://covenantpages.com/">Home</a>
 </li>
 <li class="nav-item">
 <a class="nav-link text-light" href="https://covenantpages.com/categories">Categories</a>
 </li>
 <li class="nav-item">
 <a class="nav-link text-light" href="https://covenantpages.com/contact">Contact</a>
 </li>
 </ul>
 </div>
 </div>
 </nav>
 </header>

 <!-- Main Content -->
 <main class="container py-5">
 <h2 class="display-6 text-center fw-semibold text-dark mb-4">Escambia and Santa Rosa Christian Business Directory</h2>
 <!-- Category Toggle Buttons -->
 <div class="d-flex flex-wrap justify-content-center mb-4" id="category-buttons"></div>
 <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4" id="business-cards"></div>
 </main>

 <!-- Modal for Business Details -->
 <div class="modal fade" id="businessModal" tabindex="-1" aria-labelledby="businessModalLabel" aria-hidden="true">
 <div class="modal-dialog modal-dialog-centered">
 <div class="modal-content">
 <div class="modal-header">
 <h5 class="modal-title" id="businessModalLabel"></h5>
 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
 </div>
 <div class="modal-body">
 <img src="" class="img-fluid mb-3" id="modalImage" alt="">
 <p id="modalDescription"></p>
 <p><span class="highlight">Address:</span> <span id="modalAddress"></span></p>
 <p><span class="highlight">Phone:</span> <span id="modalPhone"></span></p>
 <p><span class="highlight">Website:</span> <a id="modalWebsite" class="text-decoration-underline text-reset"></a></p>
 </div>
 <div class="modal-footer">
 <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Close</button>
 </div>
 </div>
 </div>
 </div>

 <!-- Bootstrap JS and Popper.js -->
 <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
 <script type="text/javascript">
 var gk_isXlsx = false;
 var gk_xlsxFileLookup = {};
 var gk_fileData = {};
 function filledCell(cell) {
 return cell !== '' && cell != null;
 }
 function loadFileData(filename) {
 if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
 try {
 var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
 var firstSheetName = workbook.SheetNames[0];
 var worksheet = workbook.Sheets[firstSheetName];
 var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
 var filteredData = jsonData.filter(row => row.some(filledCell));
 var headerRowIndex = filteredData.findIndex((row, index) =>
 row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
 );
 if (headerRowIndex === -1 || headerRowIndex > 25) {
 headerRowIndex = 0;
 }
 var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
 csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
 return csv;
 } catch (e) {
 console.error(e);
 return "";
 }
 }
 return gk_fileData[filename] || "";
 }

 // Function to parse CSV
 function parseCSV(csvText) {
 const rows = csvText.trim().split('\n');
 const headers = rows[0].split(',').map(header => header.trim());
 const data = [];
 for (let i = 1; i < rows.length; i++) {
 const cols = rows[i].split(',').map(col => col.trim());
 const obj = {};
 headers.forEach((header, index) => {
 obj[header] = cols[index];
 });
 data.push(obj);
 }
 return data;
 }

 // Function to sanitize category names for CSS classes
 function sanitizeCategory(category) {
 return category ? category.replace(/[\s;,&\/]+/g, '-') : 'Uncategorized';
 }

 // Function to create category buttons
 function createCategoryButtons(categories, businesses) {
 const container = document.getElementById('category-buttons');
 categories.forEach((category, index) => {
 const button = document.createElement('button');
 button.className = `btn category-btn ${index === 0 ? 'active' : ''}`;
 button.textContent = category ? category.replace(/;/g, ',') : 'Uncategorized';
 // Use sanitized category for data attribute
 button.dataset.category = sanitizeCategory(category);
 button.addEventListener('click', () => {
 // Remove active class from all buttons
 document.querySelectorAll('.category-btn').forEach(btn => {
 btn.classList.remove('active');
 });
 // Add active class to clicked button
 button.classList.add('active');
 // Show cards for selected category
 filterCardsByCategory(button.dataset.category);
 });
 container.appendChild(button);
 });
 }

 // Function to filter cards by category
 function filterCardsByCategory(selectedCategory) {
 document.querySelectorAll('.card-col').forEach(card => {
 if (card.classList.contains(`category-${selectedCategory}`)) {
 card.classList.add('active');
 } else {
 card.classList.remove('active');
 }
 });
 }

 // Function to create business cards
 function createBusinessCards(businesses) {
 const container = document.getElementById('business-cards');
 businesses.forEach(business => {
 const card = document.createElement('div');
 // Add category class (sanitize category name)
 const categoryClass = `category-${sanitizeCategory(business.category)}`;
 card.className = `col card-col ${categoryClass}`;
 card.innerHTML = `
 <div class="card h-100 border-0 shadow">
     <div class="card-body">
         <h3 class="card-title fs-4 fw-semibold">${business.name}</h3>
         <p class="card-text text-muted">${business.description}</p>
         <p class="text-muted small"><span class="highlight">Services:</span> ${business.services ? business.services.replaceAll(';', ',') : "No services listed."}</p>         
         <br><br>
         <div class="d-flex justify-content-end position-absolute bottom-0 end-0 p-3">
            <span class="small hover-text">More Details</span>
        </div>
     </div>
 </div>
 `;
 // Add click event to open modal
 card.addEventListener('click', () => {
 document.getElementById('businessModalLabel').textContent = business.name || 'Unknown Business';
 const modalBody = document.querySelector('#businessModal .modal-body');
 modalBody.innerHTML = ` 
 <img src="https://covenantpages.com/${business.id}.png" class="card-img-top" alt="${business.name}">
 <p id="modalDescription" class="fw-semibold">${business.description || 'No description available.'}</p>
 <p id="modalOwner"><span class="highlight">Owner:</span> ${business.owner || 'No owner listed.'}</p>
 <p id="modalPhone"><span class="highlight">Phone:</span> ${business.phone || 'No phone available.'}</p>
 ${business.email ? `<p id="modalEmail"><span class="highlight">Email:</span> ${business.email || 'No email available.'}</p>` : ''}
 <p id="modalServices"><span class="highlight">Services:</span> ${business.services ? business.services.replaceAll(';', ',') : 'No services listed.'}</p>
 <p id="modalAddress"><span class="highlight">Address:</span> ${business.address ? business.address.replaceAll(';', ',') : 'No address available.'}</p>
 <p id="modalArea"><span class="highlight">Service Area:</span> ${business.area || 'No services listed.'}</p>
 ${business.website ? `<a href="${business.website}" class="btn accent-bg mt-3">Visit Website</a>` : ''}
 `;
 const modal = new bootstrap.Modal(document.getElementById('businessModal'));
 modal.show();
 });
 container.appendChild(card);
 });

 // Add hover effects
 document.querySelectorAll('.card').forEach(card => {
 card.addEventListener('mouseenter', () => {
 card.classList.add('border-primary', 'border-2');
 });
 card.addEventListener('mouseleave', () => {
 card.classList.remove('border-primary', 'border-2');
 });
 });
 }

 // Load and process CSV
 fetch('https://covenantpages.com/businesses.csv')
 .then(response => response.text())
 .then(csvText => {
 const businesses = parseCSV(csvText);
 // Get unique categories
 const categories = [...new Set(businesses.map(b => b.category || 'Uncategorized'))];
 // Create category buttons
 createCategoryButtons(categories, businesses);
 // Create business cards
 createBusinessCards(businesses);
 // Filter cards for the first category after cards are created
 const firstCategory = categories[0] ? sanitizeCategory(categories[0]) : 'Uncategorized';
 filterCardsByCategory(firstCategory);
 })
 .catch(error => console.error('Error loading CSV:', error));
 </script>
</body>
</html>
